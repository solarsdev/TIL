# Databases

## 데이터베이스 선택 기준

- AWS에서 제공하는 다양한 데이터베이스 중 어떤것을 선택해야 하는가
- 데이터베이스의 선택 기준
  - 읽기 빈도, 처리량, 이러한 기준의 도중 변경 유무
  - 데이터의 저장 용량, 어느정도로 늘어나는지
  - 데이터의 가용성, 데이터 무결성
  - 지연속도 및 동시접속수
  - 데이터의 모델, 관계형 또는 비관계형
  - 스키마 설계
  - 라이센스 및 비용
  - 클라우드 최적화 모델 (오로라 등)

## 데이터베이스 타입

- RDBMS (SQL/OLTP) RDS, 오로라 (관계형)
- NoSQL DB DDB(~JSON), ElastiCache(Key/Value), Neptune(Graphs), DocumentDB(for MongoDB), Keyspace(Cassandra)
- Object 저장소 S3 / Glacier (아카이빙)
- Data Warehouse Redshift(OLAP), Athena, EMR
- Search OpenSearch(JSON), 텍스트 검색
- Graphs Neptune
- Ledger AQLD (Amazon Quantum Ledger Database)
- Time series Timestream

## RDS

- 관리형 PostgreSQL / MySQL / MSSQL / MariaDB
- RDS 인스턴스의 크기와 EBS의 크기를 프로비전 (미리 할당)
- 용량은 자동으로 스케일링
- 복수 AZ에 대한 읽기 복제본 생성
- IAM을 통한 보안, Security Group (방화벽), KMS와 SSL을 통한 저장, 전송 중 암호화
- 35일간의 백업 보존을 통한 특정 시점 복구 지원
- DB 스냅샷을 통한 영속적 저장
- 유지보수 관리 시간을 통한 지정된 시간 동안의 백엔드 업데이트
- IAM 인증과 Secret Manager를 통한 권한 관리
- RDS Custom 기능을 통해 백엔드 인스턴스에 SSH로 직접 접근 가능 (MSSQL / Oracle)
- 관계형 데이터베이스에 최적화 (RDBMS / OLTP) SQL쿼리 실행, 트랜잭션 등

## Aurora

- PostgreSQL / MySQL에 호환성을 가진 분리형 클라우드 네이티브 DB 서비스
- 스토리지: 데이터는 6개의 복제본으로 저장되고 3개의 AZ에 나누어짐 (고가용성, 자가복구, 오토 스케일)
- 컴퓨팅: 다중 AZ에 배포된 클러스터형 구조, 읽기 복제본의 오토 스케일
- 클러스터: 읽기/쓰기 엔드포인트로의 접근을 이용한 클러스터링
- RDS와 동일한 보안/모니터링/유지보수 기능
- 포인트 투 타임 리커버리를 지원 (35일간)
- 스냅샷을 통한 영구보존 가능

### 오로라 서버리스

- 예측 불가능한 워크로드, 용량 지정 없이 운영 가능

### 오로라 멀티 마스터

- 여러개의 쓰기 인스턴스를 두고 상호간에 복제를 통해 쓰기 분산 및 장애대처

### 오로라 글로벌

- 최대 16개의 읽기 복제본을 각 리전에 배포하여 상호간의 복제 (<1초단위 복제)

### 오로라 머신 러닝

- SageMaker와 Comprehend를 오로라 쿼리에 직접 적용할 수 있도록 서비스 제공

### 오로라 데이터 클론

- 특정 시점의 오로라 데이터를 빠르게 복제하여 테스트나 스테이징 환경에서 활용할 수 있도록 지원

### 결론

- RDS와 동일하지만, 좀 더 유지보수 시간/유연성/퍼포먼스/다기능을 통해 이점을 가져가는 클라우드 네이티브 RDBMS

## ElastiCache

- 관리형 Redis/Memcached (RDS와 유사하지만, 캐시를 위함)
- 메모리 데이터 저장소, 밀리초 단위의 응답속도
- EC2 인스턴스 타입을 통해 할당이 필요 (프로비저닝 타입)
- Redis를 선택할 경우 다중 AZ 클러스터링을 지원하기 때문에 가용성이 높음, 읽기 복제본 (샤딩) 구성 가능
- IAM을 통한 인증 및 인가, 보안 그룹 설정, KMS 암호화, Redis 인증을 지원
- 백업 / 스냅샷 / 특정 시간 복원 기능이 포함됨
- 관리형으로 유지보수 시간을 지정하여 운영 가능
- 캐시 기능을 이용하기 위해서는 ElastiCache에 캐시 전략을 이용하는 코드 수정이 필요
- 사용 사례
  - 키/밸류 저장소
  - 한번 쓰고 자주 읽는 방식, DB 쿼리의 결과값 조회
  - 웹사이트의 세션 데이터
- SQL 이용 불가 (키/밸류 값방식)

## DynamoDB

- 관리형 서버리스 NoSQL 데이터베이스로 밀리초 단위의 응답속도를 제공
- 용량 모드: 프로비전 모드 (오토 스케일 옵션)와 온디맨드 용량 모드
- ElastiCache의 키/밸류 저장소로 교체 가능 (세션 데이터나 TTL 기능을 이용)
- 고가용성, 다중 AZ가 기본으로 읽기/쓰기 부하가 완전히 별개로 운영됨
- DAX 클러스터를 이용하여 읽기 캐시를 이용 가능
- IAM을 이용한 보안 설정 및 인증 인가
- DynamoDB Streams를 이용하면 아이템단위의 변경사항에 대해 람다나 데이터 스트림을 통한 분석 가능
- 글로벌 테이블 기능으로 액티브/액티브 다중 리전 운영이 가능
- PITR 백업/복원 (35일간), 온디맨드 백업 지원
- S3으로 추출 및 S3으로부터의 복원 가능
- 사용 사례
  - 서버리스 어플리케이션 개발 (100KBs 단위의 데이터를 다루는)
  - 분산형 서버리스 캐싱
  - SQL 쿼리를 이용하지 않는 시스템

## S3

- S3는 키/밸류 오브젝트 저장소
- 큰 오브젝트에 유용하고, 작은 데이터들을 저장하는데는 그렇게까지 유용하지는 않음 (최소 데이터 용량 등)
- 서버리스, 무제한 스케일, 5TB단위의 오브젝트까지 저장 가능, 버전 관리 기능
- 티어: S3 스탠다드/IA/인텔리전트 티어/글래시어/라이프사이클 정책 등
- 기능: 버전관리/암호화/읽기복제/MFA-Delete/엑세스로그 등
- 보안: IAM/버킷정책/ACL/엑세스포인트/람다연계/CORS/Object-Vault락
- 암호화: SSE-S3,SSE-KMS,SSE-C,Client-Side,TLS/KMS 암호화
- 배치 작업: S3 배치 오퍼레이션으로 S3 모든 오브젝트에 작업 수행 가능
- 퍼포먼스: 멀티파트업로드로 가속/S3 트랜스퍼 가속(글로벌)/S3 Select로 특정데이터만 쿼리후 가져오기 등
- 자동화: S3이벤트 알림(SNS/SQS/람다/EventBridge연계)
- 사용사례
  - 정적파일, 키밸류 (큰 파일), 웹사이트 호스팅 등
