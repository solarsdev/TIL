# CloudWatch

- 클라우드워치는 AWS 모든 서비스의 지표를 제공
- 지표는 모니터링 값을 의미 (CPU수치, 네트워크 인 아웃 등)
- 메트릭은 네임스페이스에 속함
- 디멘션은 지표의 속성임 (인스턴스 ID, 환경, 기타 등등)
- 지표당 10개의 디멘션을 설정 가능
- 지표는 타임스탬프를 가지고 있음
- 지표를 이용하여 대시보드를 만들 수 있음

## EC2 관련

- EC2 관련 지표는 5분에 한번씩 수집됨
- 강화된 모니터링을 이용하여 1분에 한번씩 수집할 수 있음
  - 이를 이용하면 오토 스케일링에 활용하는 지표가 더 빨리 수집되므로 빠르게 대응 가능
- AWS 프리티어는 10개까지 강화된 모니터링을 사용할 수 있음
- EC2의 메모리 사용량은 기본 지표가 아님 (따라서 커스텀 지표로 수동으로 보내주어야 함)

## Custom 지표

- 특정 지표를 커스텀으로 클라우드워치로 보낼 수 있음
- 디멘션을 지표에 붙일 수 있음
  - 인스턴스ID
  - 환경이름
- 지표 범위
  - 기본 : 1분
  - 상세 범위 : 1초까지 내릴 수 있음 (StorageResolution API) 비용은 더 높음
- PutMetricData를 이용해서 보냄

## CloudWatch 대시보드

- 특정 지표를 빠르게 확인할 수 있는 방법
- 대시보드는 글로벌 함
- 대시보드에는 각각 다른 리전의 정보를 표시할 수 있음
- 타임존을 변경할 수 있으며 시간 범위 또한 변경 가능
- 대시보드는 자동 리프레시 기능이 있음 (10s, 1m 2m 5m 15m)

## CloudWatch Logs

- 어플리케이션은 SDK를 이용해서 클라우드워치에 로그를 전송할 수 있음
- 로그 수집의 예
  - Elastic Beanstalk: 어플리케이션 로그
  - ECS: 컨테이너 로그
  - Lambda: 함수 로그
  - VPC Flow Logs: VPC 특정 로그
  - API Gateway
  - CloudTrail based on filter
  - Cloudwatch log agent : EC2인스턴스에 설치한 에이전트
  - Route53: DNS 쿼리 로그
  - 기타등등
- CloudWatch로그는
  - S3에 배치를 통한 엑스포트 가능 (아카이브)
  - Stream을 통해 엘라스틱 서치 클러스에 분석을 위해 보낼 수 있음
- 로그 저장소 아키텍쳐
  - 로그 그룹: 이름, 일반적으로는 어플리케이션을 대표하는 이름으로 설정
  - 로그 스트림: 어플리케이션의 인스턴스 / 로그 파일 / 컨테이너 등
- 로그 만료 기간 설정 가능 (never expire 기본, 30일 등등)
- AWS CLI를 이용해서 Cloudwatch log를 볼 수 있음
- Cloudwatch Log를 보내기 위해서는 IAM 정책이 설정되어 있어야 함
- 보안: KMS를 이용해서 로그 암호화 가능
